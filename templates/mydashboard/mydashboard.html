{% extends "base.html" %}
{% load common_tags %}
{% block site-title %}
    <title>{% if name_obj %}{{ name_obj }} on{% else %}&nbsp;{% endif %} My.jobs</title>
    <meta name="title" content="{% if name_obj %}{{ name_obj }} on{% else %}&nbsp;{% endif %} My.jobs">
{% endblock %}
{% load i18n %}
{% load user_ops %}
{% block meta-extra %}
<script src="{{ STATIC_URL }}profile.js{% cache_buster %}"></script>
<script src="http://js.nlx.org/framework/v2/js/def.ui.bootstrap.tabs.js" type="text/javascript"></script>
<script src="http://js.nlx.org/framework/v2/js/code/bootstrap-collapse.js" type="text/javascript"></script>
<script>
  $(function() {
    $( ".datepicker" ).datepicker();
  });
</script>
<script>
$(document).ready(function()
{
   $('#row-link-table tr').each(function(i,e)
   {
      $(e).children('td').click(function()
      {
         //here we are working on a td element, that's why we need
         //to refer to its parent (tr) in order to find the <a> element
         var href = $(this).closest("tr").find("a").attr("href");
         if(href)
         {
            window.location = href;
         }              
      });
   });
   
   if($(window).width() >= 501) {
        // This function will be executed when the user scrolls the page.
        $(window).scroll(function(e) {
                // Get the position of the location where the scroller starts.
                var scroller_anchor;
                try {
                    scroller_anchor = $(".scroller_anchor").offset().top;
                } catch(e) {
                    scroller_anchor = 0;
                }
     
                // Check if the user has scrolled and the current position is after the scroller start location and if its not already fixed at the top 
                if ($(this).scrollTop() >= scroller_anchor && $('#company-information').css('position') != 'fixed') 
                {    // Change the CSS of the scroller to hilight it and fix it at the top of the screen.
                    $('#company-information').css({
                            'width': '288px',
                            'position': 'fixed',
                            'top': '10px'
                });
                // Changing the height of the scroller anchor to that of scroller so that there is no change in the overall height of the page.
                $('.scroller_anchor').css('height', '50px');
                } 
                else if ($(this).scrollTop() < scroller_anchor && $('#company-information').css('position') != 'relative') 
                {    // If the user has scrolled back to the location above the scroller anchor place it back into the content.
         
                    // Change the height of the scroller anchor to 0 and now we will be adding the scroller back to the content.
                    $('.scroller_anchor').css('height', '0px');
         
                    // Change the CSS and put it back to its original position.
                    $('#company-information').css({
                            'width': 'auto',
                            'top': '0px',
                            'position': 'relative'
                });
                }
        });
    }
   
});
</script>
{% endblock %}

{% block content %}
<style>
#profileTitleRow{
    margin-bottom: 20px;
}
#profileTitleRow img{
    border-radius:5px;
    border: 2px solid #b34529;
}
#profileTitleBar{
    border-bottom: 2px solid #b34529;
}
#profileSubtitleBar{}
</style>
<div class="wrapper"> 
    <div class="row" id="profileTitleRow">        
        <div class="span12" id="profileTitleBar">
            <h1>{{company_name}}</h1>            
        </div>
        <div class="span12" id="profileSubtitleBar">
            &nbsp;
        </div>
    </div>
    <div class="row">
        <div class="span8" id="moduleColumn">            
        
            <div class="formBox">
            <h3>Candidate Activity</h3>
                
                <form action='/dashboard/' method='POST' class="move-left">
                    {% csrf_token %}
                    <div class="span2 form-label"><strong>Date Range:</strong></div><input name="after" type="text" placeholder="{{ after|date:'m/d/Y' }}" class="datepicker"> <strong>to</strong> <input name="before" type="text" placeholder="{{ before|date:'m/d/Y' }}" class="datepicker"></br>
                    <div class="span2 form-label">&nbsp;</div><input class="btn" type="submit" name="today" id="today" value="Today">&nbsp;<input class="btn" type="submit" name="seven_days" id="seven_days" value="7 Days">&nbsp;<input class="btn" type="submit" name="thirty_days" id="thirty_days" value="30 days">
                    <br><br>
                    <div class="span3 form-label"><strong>Filter by site:</strong></div> 
                    <select name="microsite" class="btn">
                        
                        <option value="{{ company_name }}">All</option>
                        
                        {% for url in company_microsites %}
                        <option value="{{ url.url|cut:'http://' }}">{{ url.url|cut:"http://" }}</option>
                        {% endfor %}
                    </select>
                    <br>
                    <div class="span2 pull-right primary-btn-padding"><input type="submit" class="btn primary" value="View Activity"></div>
                </form>
                <br>
                <hr>
                {% if candidates %}
                <div class="pull-left"><strong>Activity between {{after.date}} and {{before.date}} for {{ site_name|cut:"http://" }}</strong></div><br>                                
                 <table id="row-link-table">                            
                    {% for candidate in candidates %}
                    <tr>
                        <td>
                        <img src="{{candidate.user.get_gravatar_url}}&s=35" class="gravatar pull-left">                        
                        </td>
                        <td>
                        <div class="candidate-name">{{candidate.user|get_name_obj}}</div>
                        <a href="{{ candidate.user.id }}">{{candidate.user}}</a>
                        </td>
                        <td>
                        <strong>{% if candidate.label %}{{candidate.label}}{% else %}Unlabeled{% endif %}</strong><br>
                        {{candidate.url|url_domain}}<br>
                        {{candidate.created_on.date}}                        
                        </td>
                    </tr>
                    {% endfor %}
                    
                 </table>
                 
                 <div class="pull-left span6">
                 
                 {% if candidates.has_previous %}
                    <a href="?page={{ candidates.previous_page_number }}&microsite={{ site_name }}&after={{ after|date:'m/d/Y' }}&before={{ before|date:'m/d/Y' }}">Previous</a>
                 {% else %}
                    &nbsp;
                 {% endif %}
                 &nbsp;
                 Page {{ candidates.number }} of {{ candidates.paginator.num_pages }}
                 &nbsp;
                 {% if candidates.has_next %}
                    <a href="?page={{ candidates.next_page_number }}&microsite={{ site_name }}&after={{ after|date:'m/d/Y' }}&before={{ before|date:'m/d/Y' }}">Next</a>
                 {% endif %}
                 </div>
                 {% else %}
                 <div id="no-activity">
                 <strong>There is no candidate activity between {{after.date}} and {{before.date}} for {{ site_name|cut:"http://" }}</strong>
                 </div>
                 {% endif %}
             </div>
            
        </div>
        <div class="scroller_anchor"></div>
        <div class="span4">
            
            {% include "mydashboard/profile.html" %}            
            
        </div>
    </div>
</div>

{% endblock %}
