{% extends "myjobs_base.html" %}
{% load i18n %}
{% load humanize %}

{% block meta-extra %}
<script src="{{ STATIC_URL }}saved-search-main.js"></script>
<script src="http://js.nlx.org/framework/js/code/bootstrap-modal.js"></script>
<script src="http://js.nlx.org/framework/js/code/bootstrap-tooltips.js"></script>
{% endblock %}

{% block content %}
<div class="row">
    <div class="span12">
        <h1>{% trans "Your" %} <small>{% trans "Saved Searches" %}</small></h1>
    </div>
</div>

<div class="row">
  <script type="text/javascript">
    var emails = {% if emails %}{{emails}}{%else%}""{%endif%}
  </script>
              
    <div class="span12">
      <div id="saved-search-list">
        {% if saved_searches %}
        <table class="table table-striped table-bordered">
          <thead>
            <th class="list_width">{% trans "View Jobs" %}</th>
            <th class="mobile_hide">{% trans "Search URL" %}</th>
            <th class="mobile_hide">{% trans "Frequency" %}</th>
            <th></th>
          </thead>
          <tbody>
            {% for search in saved_searches %}
            <tr rel="tooltip" title="<h5>Saved Search Details</h5><div>Last sent: {% if search.last_sent %}{{ search.last_sent }}{% else %}Never{% endif %}</div><div>Sent to: {{ search.email }}</div>">
              <td class="view_search"><div>{{ search.label }}</div><div class="label label-{% if search.is_active %}success{% else %}default{% endif %}">{% if search.is_active %}Active{%else%}Inactive{%endif%}</div></td>
              <td class="mobile_hide {% if not search.is_active %}muted{% endif %}"><a href="{{ search.url }}" target="_blank">{{ search.url }}</a></td>
              <td class="mobile_hide {% if not search.is_active %}muted{% endif %}">
                {% if search.frequency == "W" %}
                Weekly:<br />
                On {{ search.get_verbose_dow }}
                {% elif  search.frequency == "M" %}
                Monthly:<br />
                On the {{ search.day_of_month|ordinal }}
                {% else %}
                Daily
                {% endif %}
              </td>
              <td>
                <a href="/saved-search/{{search.id}}" class="btn view mobile_hide">View</a>
                <a href="/saved-search/edit/{{search.id}}" class="btn edit">Edit</a>
            </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        {% else %}
        <p>No Saved Searches!</p>
        {% endif %}
        <a id="new_btn" data-toggle="modal" class="btn">{% trans 'New Saved Search' %}</a>
      </div>
    </div>
</div>

<div class="row">
    <div class="formBox span7">
    <h5>Digest Options</h5>
    <p>Each day, you will receive a digest email containing the results of your saved searches that would have otherwise sent you results.</p>
    <form method="post" id="digest-option">
      {% csrf_token %}
        <div>{{ form.is_active}}{{form.is_active.label_tag}}
        {{form.email}}</div>
        <div>{{ form.send_if_none }}{{form.send_if_none.label_tag}}</div>
      <div class="pull-right">
      <span id="saved"></span>
      <button id="digest_save" type="submit" value="submit" id="digest_submit">Save</button>
      </div>
    </form>
</div>

<div id="new_modal" class="modal hide fade">
    <div class="modal-header">
        <button type="button" class="close mobile_hide" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h1>{% trans "Save" %} <small>{% trans "a Search" %}</small></h1>
    </div>
    <form method="post" id="saved-search-form">
    <div class="modal-body">
        <div class="formBox">
            {% include "includes/form-error-highlight.html" with form=add_form %}
            {% csrf_token %}
        </div>
    </div>
    <div class="modal-footer">
        <div class="actions">
          <a id="add_save" class="btn pull-right">Save</a>
          <button id="add_cancel" data-dismiss="modal" aria-hidden="true" class="btn pull-right">{% trans 'Cancel' %}</button>
        </div>
    </div>
    </form>
</div>
{% endblock content %}
