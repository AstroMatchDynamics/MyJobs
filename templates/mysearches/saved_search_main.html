{% extends "myjobs_base.html" %}
{% load i18n %}
{% load humanize %}

{% block meta-extra %}
<script src="{{ STATIC_URL }}saved-search-main.js"></script>
<script src="http://js.nlx.org/framework/js/code/bootstrap-modal.js"></script>
{% endblock %}

{% block content %}
<div class="row">
    <div class="span12">
        <h1>{% trans "Your" %} <small>{% trans "Saved Searches" %}</small></h1>
    </div>
</div>

<div class="row">
  <script type="text/javascript">
    var emails = {% if emails %}{{emails}}{%else%}""{%endif%}
  </script>
              
    <div class="span12">
      <div id="saved-search-list">
        {% if saved_searches %}
        <table class="table table-striped table-bordered">
          <thead>
            <th class="list_width">{% trans "View Jobs" %}</th>
            <th class="mobile_hide">{% trans "Search URL" %}</th>
            <th class="mobile_hide">{% trans "Frequency" %}</th>
            <th></th>
          </thead>
          <tbody>
            {% for search in saved_searches %}
            <tr>
              <td class="view_search"><div>{{ search.label }}</div><div class="label label-{% if search.is_active %}success{% else %}default{% endif %}">{% if search.is_active %}Active{%else%}Inactive{%endif%}</div></td>
              <td class="url mobile_hide {% if not search.is_active %}muted{% endif %}"><a href="{{ search.url }}" target="_blank">{{ search.url }}</a></td>
              <td class="frequency mobile_hide {% if not search.is_active %}muted{% endif %}">
                {% if search.frequency == "W" %}
                Weekly:<br />
                On {{ search.get_verbose_dow }}
                {% elif  search.frequency == "M" %}
                Monthly:<br />
                On the {{ search.day_of_month|ordinal }}
                {% else %}
                Daily
                {% endif %}
                <div id="search_{{ search.id }}" class="modal hide fade">
                    <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                      <h3>{{ search.label }} <small>Details</small></h3>
                    </div>
                    <div class="modal-body">
                        <label class="form-label pull-left">Status:</label>
                        <div class="label label-{% if search.is_active %}success{% else %}default{% endif %}">{% if search.is_active %}Active{% else %}Inactive{% endif %}</div>
                        <div class="clear"></div>

                        <label class="form-label pull-left">Search URL:</label>
                        <a href="{{ search.url }}" target="_blank">{{ search.url }}</a>
                        <div class="clear"></div>

                        <label class="form-label pull-left">Frequency:</label>
                        {% if search.frequency == "W" %}
                        <strong>Weekly</strong>
                        on {{ search.get_verbose_dow }}
                        {% elif  search.frequency == "M" %}
                        <strong>Monthly</strong>
                        on the {{ search.day_of_month|ordinal }}
                        {% else %}
                        <strong>Daily</strong>
                        {% endif %}
                        <div class="clear"></div>

                        <label class="form-label pull-left">Last Sent:</label>
                        <div>{% if search.last_sent %}{{ search.last_sent }}{% else %}Never{% endif %}</div>
                        <div class="clear"></div>
                        <label class="form-label pull-left">Sent To:</label>
                        <div>{{ search.email }}</div>
                        <div class="clear"></div>
                        <label class="form-label pull-left">Notes and Comments:</label>
                        <div>{% if search.notes %}{{ search.notes }}{% else %}None{% endif %}</div>
                    </div>
                    <div class="modal-footer">
                        <a class="btn" data-dismiss="modal">Close</a>
                        <a href="{{ search.id }}" class="btn primary edit">Edit</a>
                    </div>
                </div>
              </td>
              <td class="buttons">
                <a href="{% url 'view_full_feed' search_id=search.id %}" class="btn mobile_hide">View</a>
                <a href="{{ search.id }}" class="btn edit">Edit</a>
                <a href="{{ search.id }}" class="btn mobile_hide details">Details</a>
            </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        {% else %}
        <p>No Saved Searches!</p>
        {% endif %}
        <a id="new_btn" data-toggle="modal" class="btn">{% trans 'New Saved Search' %}</a>
      </div>
    </div>
</div>

<div class="row">
    <div class="formBox span7">
    <h5>Digest Options</h5>
    <p>Each day, you will receive a digest email containing the results of your saved searches that would have otherwise sent you results.</p>
    <form method="post" id="digest-option">
      {% csrf_token %}
        <div>{{ form.is_active}}{{form.is_active.label_tag}}
        {{form.email}}</div>
        <div>{{ form.send_if_none }}{{form.send_if_none.label_tag}}</div>
      <div class="pull-right">
      <span id="saved"></span>
      <button type="submit" value="submit" class="btn primary" id="digest_submit">Save</button>
      </div>
    </form>
</div>

<div id="new_modal" class="modal hide fade">
    <div class="modal-header">
        <button class="close mobile_hide" aria-hidden="true" data-dismiss="modal" type="button">Ã—</button>
        <h1>{% trans "Save" %} <small>{% trans "a Search" %}</small></h1>
    </div>
    <form method="post" id="saved-search-form">
    <div class="modal-body">
        <div class="formBox">
        {% include "includes/form-error-highlight.html" with form=add_form %}
        </div>
    </div>
    {% csrf_token %}
    <div class="modal-footer">
        <div class="actions">
          <a id="new_search" class="btn pull-right primary save">Save</a>
          <a data-dismiss="modal" aria-hidden="true" class="btn pull-right">{% trans 'Cancel' %}</a>
        </div>
    </div>
    </form>
</div>
<div id="edit_modal" class="modal hide fade">
</div>
{% endblock content %}
