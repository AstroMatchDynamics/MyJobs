{% extends "myjobs_base.html" %}
{% load i18n %}
{% load humanize %}

{% block meta-extra %}
<script src="{{ STATIC_URL }}saved-search-main.js"></script>
{% endblock %}

{% block content %}
<div class="row">
  <script type="text/javascript">
    var emails = {% if emails %}{{emails}}{%else%}""{%endif%}
  </script>
              
    <div class="span12">
      <h2>{% trans "Your Saved Searches" %}</h2>
      <div id="saved-search-list">
        {% if saved_searches %}
        <table class="table table-striped table-bordered">
          <thead>
            <th class="list_width">{% trans "Label" %}</th>
            <th>{% trans "Status" %}</th>
            <th class="mobile_hide">{% trans "Search URL" %}</th>
            <th class="mobile_hide">{% trans "Email Frequency" %}</th>
            <th class="mobile_hide">{% trans "Last Sent" %}</th>              
            <th class="mobile_hide">{% trans "Send Results to" %}</th>
            <th class="mobile_hide"></th>
          </thead>
          <tbody>
            {% for search in saved_searches %}
            <tr>
              <td>{{ search.label }}</td>
              <td><span class="label label-{% if search.is_active %}success{% else %}default{% endif %}">{% if search.is_active %}Active{%else%}Inactive{%endif%}</span>
              </td>
              <td class="mobile_hide {% if not search.is_active %}inactive_search{% endif %}">{{ search.url }}</td>
              <td class="mobile_hide {% if not search.is_active %}inactive_search{% endif %}">
                {% if search.frequency == "W" %}
                Weekly<br />
                On {{ search.get_verbose_dow }}
                {% elif  search.frequency == "M" %}
                Monthly<br />
                On the {{ search.day_of_month|ordinal }}
                {% else %}
                Daily
                {% endif %}
              </td>
              <td class="mobile_hide {% if not search.is_active %}inactive_search{% endif %}">{{ search.last_sent }}</td>
              <td class="mobile_hide {% if not search.is_active %}inactive_search{% endif %}">{{ search.email }}</td>
              <td class="mobile_hide">
                <a href="/saved-search/{{search.id}}" class="btn">View</a>
                <a href="/saved-search/edit/{{search.id}}" class="btn">Edit</a>
            </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        {% else %}
        <p>No Saved Searches!</p>
        {% endif %}
        <a href="{% url 'add_saved_search' %}" class="btn">{% trans 'New Saved Search' %}</a>
        <div class="formBox digestBox">
        <p>Each day, you will receive a digest email containing the results of your saved searches that would have otherwise sent you results.</p>
        <form action="" method="post" id="digest-option">
          {% csrf_token %}
            {{ form.is_active}}{{form.is_active.label|attrs:"display:inline-block;"}}
            {{form.email}}
            {{ form.send_if_none }}{{form.send_if_none.label_tag}}
          <div class="pull-right">
          <span id="saved"></span>
          <button type="submit" value="submit" id="digest_submit">Save</button>
          </div>
        </form>
        </div>
      </div>
    </div>
</div>
{% endblock content %}
