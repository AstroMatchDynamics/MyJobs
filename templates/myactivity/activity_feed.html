{% extends 'base.html' %}

{% load i18n %}
{% load user_ops %}

{% block meta-extra %}
<script src="http://js.nlx.org/framework/v2/js/def.ui.bootstrap.tabs.js" type="text/javascript"></script>
<script src="http://js.nlx.org/framework/v2/js/code/bootstrap-collapse.js" type="text/javascript"></script>
{% endblock %}

{% block content %}
<form action='/activity/' method='POST'>
    {% csrf_token %}
    Microsite: <input name="microsite" type="text"></br>
    After this date: <input name="after" type="date"></br>
    Before this date: <input name="before" type="date"></br>
    <input type="submit" value="View another microsite">
</form>

<div class="row">
    <div class="span12">
        <div class="pull-left"><h2>{{site}}</h2> between {{after}} and {{before}}</div>
        <a href="http://{{site}}" target="_blank" class="btn pull-right">{% trans 'Visit Site' %}</a>
    </div>
</div>
<div class="row">
    <div class="span6">
        <div class="accordion" id="search-collapse">
            <div class="accordion-group">
                <div class="accordion-heading">
                    <a class="accordion-toggle" data-toggle="collapse" data-parent="#search-collapse" href="#search-table">Saved Searches (Collapse)</a>
                </div>
                <div id="search-table" class="accordion-body collapse in">
                    <div class="accordion-inner">
                        <table class="table table-striped table-bordered">
                            {% for search in searches %}
                            <tr id="search-{{search.id}}"><td>
                                <ul style="list-style-type: none; margin-left: -10px;">
                                    <li>{% if search.label %}{{search.label}}{% else %}Unlabeled{% endif %}</li>
                                    <li>{{search.url}}</li>
                                    <li>{{search.created_on}}</li>
                                    <li>{{search.user}}</li>
                                </ul>
                            </td></tr>
                            {% endfor %}
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="span6">
        <div class="accordion" id="user-collapse">
            <div class="accordion-group">
                <div class="accordion-heading">
                    <a class="accordion-toggle" data-toggle="collapse" data-parent="#user-collapse" href="#user-table">Users (Collapse)</a>
                </div>
                <div id="user-table" class="accordion-body collapse in">
                    <div class="accordion-inner">
                        <table class="table table-striped table-bordered">
                            {% with searches|get_distinct_users as users %}
                            {% for user, name in users.items %}
                            <tr id="user-{{user.id}}"><td>
                                <img src="{{user.get_gravatar_url}}&s=50" class="pull-left">
                                <ul style="list-style-type: none;">
                                    <li>{% if name %}{{name}}{% else %}{% trans 'Name not provided' %}{% endif %}</li>
                                    <li>{{user.email}}</li>
                                </ul>
                            </td></tr>
                            {% endfor %}
                            {% endwith %}
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
