{% extends "base.html" %}
{% load common_tags %}
{% block site-title %}
    {% with name_obj=user.full_name %}
        <title>PRM Overview - {{ company.name }}</title>
        <meta name="title" content="PRM Overview - {{ company.name }}">
    {% endwith %}
{% endblock %}
{% load i18n %}
{% load label_tags %}

{% block content %}
    <h1><a href="{% url 'prm' %}?company={{ company.id }}">{{ company.name }}</a> <small>{{ partner.name }}</small></h1>
    <div class="row">
        <div class="span12 prm-header">
            <span>Overview</span>
        </div>
    </div>
    <div class="row">
        <div class="span8">
            <div class="formBox no-padding">
                <h4>Most Recent Activity</h4>
                <div class="formBox-content">
                    {% if recent_activity %}
                    {% else %}

                    No Recent Activity

                    {% endif %}
                </div>
                {% if recent_activity %}

                {% else %}
                <div class="formBox-footer">
                    <div class="pull-right">
                        <button class="btn" disabled><span id="prm-arrow-left"></span></button>
                        <button class="btn" disabled><span id="prm-arrow-right"></span></button>
                    </div>
                    <div class="clear"></div>
                </div>
                {% endif %}
            </div>

            <div class="formBox no-padding">
                <h4>Most Recent Communication Records</h4>
                <table class="table table-bordered table-striped">
                    <thead>
                        <tr>
                            <td>Date/Time</td>
                            <td>Contact</td>
                            <td>Communication</td>
                        </tr>
                    </thead>
                    {% if recent_communication %}
                    {% else %}
                    <tr>
                        <td>No Recent Communication Records</td>
                        <td></td><td></td>
                    </tr>
                    {% endif %}
                </table>
                <div class="formBox-footer">
                    <div class="pull-right">
                        <a class="btn" href="">Communication Records</a>
                    </div>
                    <div class="clear"></div>
                </div>
            </div>

            <div class="formBox no-padding">
                <h4>Most Recent Saved Searches</h4>
                <table class="table table-bordered table-striped">
                    <thead>
                        <tr>
                            <td>Label</td>
                            <td>Search URL</td>
                            <td>Status</td>
                        </tr>
                    </thead>
                    {% if recent_ss %}
                    {% for ss in recent_ss %}
                        <tr>
                            <td>{{ ss.label }}</td>
                            <td><a href="{{ ss.url }}" target="_blank">{{ ss.url }}</a></td>
                            <td>{% make_label ss.is_active "pull-right" %}</td>
                        </tr>
                    {% endfor %}
                    {% else %}
                    <tbody>
                        <tr>
                            <td>No Recent Saved Searches</td>
                            <td></td><td></td>
                        </tr>
                    </tbody>
                    {% endif %}
                </table>
                <div class="formBox-footer">
                    <div class="pull-right">
                        <a class="btn" href="{% url 'partner_searches' %}?company={{ company.id }}&partner={{ partner.id }}">Saved Searches</a>
                    </div>
                    <div class="clear"></div>
                </div>
            </div>
        </div>
        <div class="span4">
        <div class="info-box">
            <script type="text/javascript" src="https://www.google.com/jsapi"></script>
            <script type="text/javascript">
              google.load("visualization", "1", {packages:["corechart"]});
              google.setOnLoadCallback(drawChart);
              function drawChart() {
                var data = google.visualization.arrayToDataTable([
                  ['Records', 'All Records'],
                  ['Email',     5],
                  ['Phone Calls',      2],
                  ['Face to Face',  2]
                ]);

                var options = {
                    legend: 'none',
                    pieHole: 0.65,
                    pieSliceText: 'none',
                    height: 180,
                    width: 180,
                    chartArea: {top:10, left:10, width: 155, height: 155}
                };

                var chart = new google.visualization.PieChart(document.getElementById('donutchart'));
                chart.draw(data, options);
              }
            </script>
            <div id="donutchart"></div>
            <a class="btn">Reports</a>
        </div>

            <div class="info-box" id="partner-details">
                <b>{{ partner.name }}</b>
                <br><br>
                {% with partner.primary_contact as contact %}
                {% if contact %}
                <b>{{ contact.name }}</b> <i>Primary Contact</i> <br>
                {% if contact.email %}
                <u>{{ contact.email }}</u> <br>
                {% endif %}
                {% if contact.address_line_one %}
                {{ contact.address_line_one }}
                    {% if contact.address_line_two %}
                    {{ contact.address_line_two }} <br>
                    {% else %}
                    <br>
                    {% endif %}
                {% endif %}
                {% if contact.city %}
                {{ contact.city }},
                    {% if contact.state %}
                    {{ contact.state }}
                        {% if contact.postal_code %}
                        {{ contact.postal_code }} <br>
                        {% else %}
                            <br>
                        {% endif %}
                    {% else %}
                        <br>
                    {% endif %}
                {% else %}
                    {% if contact.state %}
                    {{ contact.state }}
                        {% if contact.postal_code %}
                        {{ contact.postal_code }} <br>
                        {% else %}
                            <br>
                        {% endif %}
                    {% else %}
                        {% if contact.postal_code %}
                        {{ contact.postal_code }} <br>
                        {% endif %}
                    {% endif %}
                {% endif %}
                {% if contact.phone %}
                {{ contact.phone }} <br>
                {% endif %}
                {% endif %}
                    <br>
                {% endwith %}
                <a class="btn" href="{% url 'partner_details' %}?company={{ company.id }}&partner={{ partner.id }}">Edit partner Details</a>
            </div>

        </div>
    </div>
{% endblock %}