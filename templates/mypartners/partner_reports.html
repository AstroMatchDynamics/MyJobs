{% extends "base.html" %}
{% load common_tags %}

{% block site-title %}
    <title>Partner Reports {{ company.name }}</title>
    <meta name="title" content="Partner Reports {{ company.name }}">
{% endblock %}
{% load i18n %}
{% block meta-extra %}
<script src="{{ STATIC_URL }}partner-reports.js{% cache_buster %}"></script>
<script src="{{ STATIC_URL }}record_overview.js{% cache_buster %}"></script>

<script type="text/javascript" src="https://www.google.com/jsapi"></script>
<script type="text/javascript">
    google.load("visualization", "1", {packages:["corechart"]});
</script>
<script>
var total_records = {{ total_records }};
var total_ref = {{ referral }};
var company_id = {{ company.id }};
var partner_id = {{ partner.id }};
</script>
{% endblock %}

{% block content %}
    <h1><a href="{% url 'prm' %}?company={{ company.id }}">{{ company.name }}</a> <small><a href="{% url 'partner_overview' %}?company={{ company.id }}&partner={{ partner.id }}">{{ partner.name }}</a></small></h1>
    <div class="row">
        <div class="span12 prm-header">
            <span>Reports</span>
            <a href="{% url "partner_overview" %}?company={{ company.id }}&partner={{ partner.id }}">Back to Overview</a>
        </div>
    </div>
    <div class="row">
        <div class="span6">
            <h4>Communication Activity</h4>
            {% if total_records %}
            <div class="big-chart big-trans-box" id="ajax-loading-donut">
                <img src="{{ STATIC_URL }}images/ajax-loader.gif">
            </div>
            <div class="big-chart" id="donutchart" style="display:none"></div>
            <div class="chart-box-holder" style="display:none"></div>
            {% else %}
            No recent communication activity.
            {% endif %}
        </div>

        <div class="span6">
            <h4>Referral Activity</h4>
            {% if referral %}
            <div class="big-chart big-trans-box" id="ajax-loading-bar">
                <img src="{{ STATIC_URL }}images/ajax-loader.gif">
            </div>
            <div class="big-chart" id="barchart" style="display:none"></div>
            <div class="chart-box-holder" style="display:none"></div>
            {% else %}
            No recent referral activity.
            {% endif %}
        </div>
    </div>

    <div class="row">
        <div class="span6">
            <h4>All Contacts</h4>
            {% for contact in contacts %}
            <table class="all-contacts-table">
                <tr>
                    <td>
                        <span>{% get_nonuser_gravatar contact.name '55' %}</span>
                    </td>
                    <td>
                        {{ contact.name }}<br>
                        {{ contact.email }}
                    </td>
                    <td>
                        <div class="chart-box small-chart-box inline-box">
                            <div class="big-num">{{ contact.ref_count }}</div>
                            <div class="reports-record-type">Referral Records</div>
                        </div>
                        <div class="chart-box small-chart-box inline-box">
                            <div class="big-num">{{ contact.cr_count }}</div>
                            <div class="reports-record-type">Contact Records</div>
                        </div>
                    </td>
                </tr>
            </table>
            {% endfor %}
        </div>
        <div class="span6">
            {% if top_contacts.count >= 3 %}
            <h4>Top 3 Contacts</h4>
            {% elif top_contacts.count == 2 %}
            <h4>Top {{ top_contacts.count }} Contacts</h4>
            {% else %}
            <h4>Top Contact</h4>
            {% endif %}
            <div id="top-contacts">
                {% for contact in top_contacts %}
                <div class="chart-box inline-box">
                    <div class="big-num">{{ contact.count }}</div>
                    <div class="reports-record-type">{{ contact.contact_name|truncatechars:13 }}</div>
                </div>
                {% endfor %}
                {% if others %}
                <div class="chart-box inline-box" style="margin-right:0">
                    <div class="big-num">{{ others }}</div>
                    <div class="reports-record-type">All Others</div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
{% endblock %}