{% extends "base.html" %}
{% load common_tags %}
{% load activity_tags %}
{% block site-title %}
    {% with name_obj=user.full_name %}
        <title>PRM Overview - {{ company.name }}</title>
        <meta name="title" content="PRM Overview - {{ company.name }}">
    {% endwith %}
{% endblock %}
{% load i18n %}

{% block meta-extra %}
<script src="{{ STATIC_URL }}partner-overview.js{% cache_buster %}"></script>
{% endblock %}

{% block content %}
    <h1><a href="{% url 'prm' %}?company={{ company.id }}">{{ company.name }}</a> {% if partner %}<small><a href="{% url 'partner_overview' %}?company={{ company.id }}&partner={{ partner.id }}">{{ partner.name }}</a></small>{% endif %}</h1>
    <div class="row">
        <div class="span12 prm-header">
            <span>Communication Records</span>
        </div>
    </div>
    <div class="row">
        <div class="span8">
            <a class="btn" href="{% url "partner_edit_record" %}?company={{ company.id }}&partner={{ partner.id }}" style="margin-bottom: 20px;">New Record</a>
            <div class="formBox no-padding">
                <h4>View Records</h4>

                <table class="table table-bordered table-striped">
                    {% if records %}
                    <thead>
                        <tr>
                            <td>Date/Time</td>
                            <td>Type</td>
                            <td>Details</td>
                            <td></td>
                        </tr>
                    </thead>
                    {% endif %}
                    <tbody>
                        {% if records %}
                        {% for record in records %}
                            <tr>
                                <td>{{ record.date_time }}</td>
                                <td>{{ record.get_record_description }}</td>
                                <td>
                                    Subject: {{ record.subject }}<br/>
                                    {{ record.notes }}
                                </td>
                                <td>
                                    <a href="/prm/view/records/edit?company={{ company.id }}&partner={{ partner.id }}&id={{ record.id }}">Edit</a>
                                </td>
                            </tr>
                        {% endfor %}
                        {% else %}
                        <tr>
                            <td colspan=3>No records available.</td>
                        </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </div>
        <div class="span4">
            <div class="tip-box">
                {% if most_recent_activity %}
                    <h4>Most Recent Activity <small id="activity-num" class="pull-right"></small></h4>
                    <div class="tip-content">
                        {% if most_recent_activity %}
                        <table id="activity-table" class="table table-bordered table-striped">
                            {% for activity in most_recent_activity %}
                                {% get_activity_block activity %}
                            {% endfor %}
                        </table>
                        {% endif %}
                    </div>
                {% endif %}
                <div class="tip-footer">
                    <div class="pull-right">
                        <button id="previous" class="btn"><span id="prm-arrow-left"></span></button>
                        <button id="next" class="btn"><span id="prm-arrow-right"></span></button>
                    </div>
                    <div class="clearfix"></div>
                </div>
            </div>
            <div class="tip-box">
                <h4>Tips</h4>
                <div class="tip-content">
                    Tips go here.
                </div>
                <div class="tip-footer">
                    <a class="btn-link" href="{% url 'partner_overview' %}?company={{ company.id }}&partner={{ partner.id }}">Back to Overview Page</a>
                </div>
            </div>
        </div>
    </div>
{% endblock %}