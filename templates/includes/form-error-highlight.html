{% comment %}
form-error-highlight.html -- simple loop for displaying forms/modelforms.

Usese the following default django template tags:

hidden -- built in for all hidden form fields.
form -- the rest of the form.
{% endcomment %}
{% load widget_tweaks %}
{% load form_tags %}
{% load selection_boxes %}
<fieldset>
    {# Include but don't display hidden fields #}
    {% for hidden in form.hidden_fields %}
        {{ hidden}}
    {% endfor %}
    
    {% if form.errors %}
    <div class="alert-message block-message error">
      <ul class="errorlist">
        {% for error in form.non_field_errors %}
        <li>{{error}}</li>
        {% endfor %}
      </ul>
    </div>
    {% endif %}
    
    {# Include the visible fields #}
    {% for field in form.visible_fields %}
    	{% is_boolean_field field as is_boolean %}
    	{% is_select_field field as is_select %}

    	{% if is_boolean or not form.only_show_required or form.only_show_required and field.field.required %}
    		{% if field.errors %}
    			<div class="alert-message block-message error">
      			{{ field.errors }}
      		{% endif %}

        	{# Don't show placeholder text if auto_id is True #}
        	{% if form.auto_id %}
        		<div class='span3 form-label pull-left {{field.auto_id}}'>
          		{{ field.label_tag }}
        		</div>
        		{{ field|attr:"placeholder:" }}

        	{% elif is_select %}
        	    <div class="span3 form-label pull-left initial">&nbsp;</div>
        		<div class="input-prepend" id="{{field.name}}_prependLabel">
          			<span class="add-on">
            			{{ field.label_tag }}
          			</span>
          			{{field}}
        		</div>
        
        	{% elif is_boolean %}
        		{{field}}
        		<div class="span3 form-label pull-left checkbox-label">
         	 		{{ field.label_tag }}
        		</div>
        
        	{% elif 'country_code' in field.html_name %}
        		
        	    <div class="span3 form-label pull-left">
                <div class="clear"></div>
                {% with "id_"|add:form.prefix|add:"-country_sub_division_code" as region_id %}
        			{% country_select selected="USA" html_id=field.id_for_label  region_html_id=region_id input_name=field.html_name %}
        		{% endwith %}
        		</div>

        	{% elif 'country_sub_division_code' in field.html_name %}
                    <div class="span3 form-label pull-left"><label for="{{field.id_for_label}}">Region</label><div class="clear"></div></div>
                    <input type="hidden" name="{{field.html_name}}" value="{{field.value|default_if_none:" "}}" id="{{field.id_for_label}}" />
        	{% else %}
        		{% if '_dialing' in field.html_name or field.html_name == "telephone-number" or field.html_name == "telephone-extension" %}
        			<div class="input-prepend" data-for="{{field.id}}">
         				<span class="add-on">
            				{{ field.label_tag }}
          				</span>
          				{{field}}
        			</div>
        		{% else %}
        			<div class="span3 form-label pull-left initial">{{ field.label_tag }}</div><div class="profile-form-input">{{ field  }}</div>
        		{% endif %}
		{% endif %}

                {% if field.errors %}
                    </div>
                {% endif %}

        {% if field.help_text %}
        	<span class="help-block">{{ field.help_text }}</span>
			<div class="clear"></div>
        {% endif %}

        {% if field.errors %}
        	<div class="clear"></div>
        {% endif %}
                <div class="clear"></div>
        {% endif %}

        {% if field.html_name == "gravatar" %}
        	<div class="form-label pull-left">
            	<img src="{{ gravatar_100 }}" id="gravatar-img">
            </div>
            <a href="http://www.gravatar.com" target="_blank" id="gravatar-link">Change your profile image on gravatar.com</a>
            <div class="clear"></div>
        {% endif %}
	{% endfor %}
</fieldset>
