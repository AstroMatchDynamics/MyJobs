function Pager() {
	this._MIN_VISIBLE = 10;
	this._PAGE_SIZE = 20;
	this._HIDDEN_CLASS_NAME = "direct_hiddenOption";
	
    // -count
    this._sortType = 'count';
	
	this._alpha_sort_direction = "-index";
	this._numeric_sort_direction = "count";
	this._current_sort_direction = this._numeric_sort_direction;
	
	this._subnav_cache = {};
    this._subnav_cache[this._current_sort_direction] = $('#direct_subnav_ul').html();
}


Pager.prototype = {

    showLessHandler: function(e, num_items) {
		// get the list to act on
		var clickedLink = e.target;
		var parentEl = $(clickedLink).parent();
		var itemListId = this._getListElementFromContainerId(parentEl.attr('id'));
		
		// hide the items
		this._showLessItems(itemListId, num_items, num_items)
		
		// toggle more/less link, if needed
		this._toggleLessLink(itemListId, num_items);
		this._toggleMoreLink(itemListId);
		
		// stop default behavior of the link, since we're 
		// not really using it as a link.  yeah, its not ideal.
		return false;
	},
	
	showMoreHandler: function(e, num_items) {
		var clickedLink = e.target;
		var parentEl = $(clickedLink).parent();
		var type = parentEl.attr('data-type');
		var itemListId = this._getListElementFromContainerId(parentEl.attr('id'));
		
		this._showMoreItems(itemListId, num_items, type);
		
		// toggle more/less links, if needed
		this._toggleLessLink(itemListId, num_items);
		
		// stop default behavior of the link, since we're 
		// not really using it as a link.  yeah, its not ideal.
		return false;
	},
	
	sortNumericHandler: function(e) {
		this._numeric_sort_direction = (this._numeric_sort_direction == '-count') ? 'count' : '-count';
		this._current_sort_direction = this._numeric_sort_direction;
		
	    if(this._subnav_cache[this._numeric_sort_direction]) {
	    	$('#direct_subnavUl').html(this._subnav_cache[this._numeric_sort_direction]);
	        $('#direct_moreLessLinks_subnavUl .direct_optionsLess').hide();
	        $('#direct_moreLessLinks_subnavUl .direct_optionsMore').show();
	    } else {
	    	num_items = {{site_config.num_subnav_items_to_show}};
		    if(this._numeric_sort_direction[0] == '-') {
                sort_direction = 'reverse';
            } else {
                sort_direction = 'standard';
            }
            sort_by = 'count';

			data = {
				'offset': 0,
				'num_items': num_items,
                'sort': sort_by,
                'sort_direction': sort_direction,
				'type': 'subNav'
			}
			
			var that = this;
			var url = this._build_url('subNav')
	    	$.get(
				url,
				data,
				function(data){
	            	$('#direct_subnavUl').html(data);
	            	$('#direct_moreLessLinks_subnavUl .direct_optionsLess').hide();
	            	$('#direct_moreLessLinks_subnavUl .direct_optionsMore').show();
	            	that._subnav_cache[that._numeric_sort_direction] = $('#direct_subnav_ul').html();
	        });
	    }
		// stop default behavior of the link, since we're 
		// not really using it as a link.  yeah, its not ideal.
		return false;
	},
	
	sortAlphaHandler: function(e) {
		this._alpha_sort_direction = (this._alpha_sort_direction == 'index') ? '-index' : 'index';
		this._current_sort_direction = this._alpha_sort_direction;

	    if(this._subnav_cache[this._alpha_sort_direction]) {
	    	$('#direct_subnavUl').html(this._subnav_cache[_alpha_sort_direction]);
	        $('#direct_moreLessLinks_subnavUl .direct_optionsLess').hide();
	        $('#direct_moreLessLinks_subnavUl .direct_optionsMore').show();
	    } else {
	    	num_to_fetch = {{site_config.num_subnav_items_to_show}};
            if(this._alpha_sort_direction[0] == '-') {
                sort_direction = 'reverse';
            } else {
                sort_direction = 'standard';
            }   
            sort_by = 'index';	
			data = {
				'offset': 0,
				'num_items': num_to_fetch,
				'sort': sort_by,
                'sort_direction': sort_direction,
				'type': 'subNav'
			}
			
			var that = this;
			var url = this._build_url('subNav')
	    	$.get(
				url,
				data,
				function(data){
		            $('#direct_subnavUl').html(data);
		            $('#direct_moreLessLinks_subnavUl .direct_optionsLess').hide();
	        		$('#direct_moreLessLinks_subnavUl .direct_optionsMore').show();
		            that._subnav_cache[that._current_sort_direction] = $('#direct_subnav_ul').html();
	        });
	    }
		// stop default behavior of the link, since we're 
		// not really using it as a link.  yeah, its not ideal.
		return false;
	},
	
	_toggleLessLink: function(itemListId, minVisible) {
		// we want to turn the 'Less' link off when
		// we're at the minVisible limit.
		
		// if minVisible = 10 and there's 11, we want 
		// to just hide 1 element, if there's 16 showing
		// we'd want to hide 6
		var jqItemList = $("#"+itemListId);
		var currNumVisible = jqItemList.children(':visible').length;
		
		var jqLessLink = this._getLinkForItemList(jqItemList, "less");
		
		(currNumVisible > minVisible) ? jqLessLink.show() : jqLessLink.hide();
	},
	
	_toggleMoreLink: function(itemListId) {
		var jqItemList = $("#"+itemListId);
		var numHiddenItems = jqItemList.children("."+this._HIDDEN_CLASS_NAME).length;
		
		var jqMoreLink = this._getLinkForItemList(jqItemList, "more");
		
		(numHiddenItems > 0) ? jqMoreLink.show() : jqMoreLink.hide();
	},
	
	_getLinkForItemList: function(jqItemList, moreOrLess) {
		var itemListId = jqItemList.attr('id');
		var linkClassNames = {
			'more': ".direct_optionsMore",
			'less': ".direct_optionsLess"
		}
		var selector = "#direct_moreLessLinks_" + itemListId.split('_')[1] + " " + linkClassNames[moreOrLess];
		return $(selector);
	},
	
	_getListElementFromContainerId: function(linkContainerId) {
		// Current List IDs that we'll be looking for:
		// - direct_titleDisambig
		// - direct_countryDisambig
		// - direct_stateDisambig
		// - direct_cityDisambig
		// - direct_jobListing
		// - direct_facetDisambig
		// - direct_mocDisambig
		
		// We've attached the second part onto the ID of
		// the <span> tag that wraps the more/less links,
		// so we can pull it off of there to know which
		// list we should take action on.
		
		// i.e. <span id="direct_moreLessLinks_countryDisambig">
		var baseElementId = "direct_%s";
		var idPieces = linkContainerId.split('_');
		var listId = idPieces[2];

		return baseElementId.replace('%s', listId);
	},
	
	_showMoreItems: function(listId, numToShow, type){
		var itemList = $("#" + listId);
		var hiddenItems = itemList.children("." + this._HIDDEN_CLASS_NAME);
		var currNumHidden = hiddenItems.length;
		
		// if we have current hidden ones, lets show those
		if(currNumHidden > 0) {
			// if there's less hidden items than what we want to show
			// then we'll only show those and if there's zero hidden,
			// then we'll go get some more and still show the number
			// we want to
			numToShow = (numToShow > currNumHidden) ? currNumHidden : numToShow;
			
			hiddenItems.slice(0, numToShow).removeClass(this._HIDDEN_CLASS_NAME);
			currNumHidden -= numToShow;
		}
		
		if(currNumHidden == 0) {
			// lets see if we have any to get from the server
			var data = {
				'offset': itemList.children().length,
				'num_items': this._PAGE_SIZE
			};
			if(type === 'subNav') {
				data.sort = this._current_sort_direction;
			}
			this._ajax_getItems(type, data, listId);
		}
	},
	
	_showLessItems: function(listId, numToHide, minVisible){
		var itemList = $("#" + listId);
		var visibleItems = itemList.children(':visible');
		var numVisible = visibleItems.length;
		var numAvailableToHide = numVisible - minVisible;
		
		if (numAvailableToHide < numToHide) {
			numToHide = numAvailableToHide;
		}
		
		if (numToHide > 0) {
			visibleItems.slice(-numToHide).addClass(this._HIDDEN_CLASS_NAME);
		}
	},
	
	_ajax_getItems: function(type, data, elem){
		var that = this;
		var url = this._build_url(type)
		$.get(
			url,
			data,
			function(html) {
				that._getItemsSuccessHandler(html, elem);
			}
		);
	},
	
	_build_url: function(type){
		// Build the URL with the current path as our
		// 'filter' that is sent into to filter objects
		var path = window.location.pathname;
		var urls = {
			"title": "titles/",
			"city": "cities/",
			"state": "states/",
			"country": "countries/",
			"facet": "facets/",
			"moc": "mocs/",
			"listing": "joblisting/",
			"subNav": "primary_nav_items/"
		}
		return path+urls[type];
	},
	
	_getItemsSuccessHandler: function(html, insertIntoElem){
		// From the Django templates we get a lot of line breaks,
		// so we'll remove them right here, just to be safe
		html = html.replace(/\n/g, "");
		if (html) {
			$("#" + insertIntoElem).children(":last").after(html);
		}
		this._toggleMoreLink(insertIntoElem);
	}
};
